# Scripts/Customers 文件夹未使用代码分析报告

## 分析概述

本报告分析了 `Scripts/Customers` 文件夹中所有 C# 脚本，识别出那些实际上没有被其他脚本调用、引用或使用的代码内容。

## 完全未使用的类

### 1. TraitHooks.cs
**文件位置**: `Scripts/Customers/Data/TraitHooks.cs`
**状态**: 整个文件完全未被使用

**未使用内容**:
- `TraitHook` 抽象类及其所有虚方法:
  - `OnSpawn(CustomerAgent agent)`
  - `OnTargetChosen(CustomerAgent agent, string shelfId)`
  - `OnQueueEnter(CustomerAgent agent, string pointId)`
  - `OnPurchaseComputed(CustomerAgent agent, string shelfId, ref int qty)`
  - `OnCheckout(CustomerAgent agent, int spent)`
  - `OnLeave(CustomerAgent agent, string reason)`

**说明**: 这是为特质行为钩子预留的框架，但目前没有任何具体实现或调用。

### 2. TraitRegistry.cs
**文件位置**: `Scripts/Customers/Services/TraitRegistry.cs`
**状态**: 整个服务类完全未被使用

**未使用内容**:
- `TraitRegistry` 类的所有成员:
  - `Instance` 单例
  - `BuildIndex()` 方法
  - `Get(string id)` 方法
  - `Resolve(string[] ids)` 方法
  - `traits` 列表字段

**说明**: 虽然类已实现，但没有任何地方实例化或调用其方法。

### 3. NavigationService.cs
**文件位置**: `Scripts/Customers/Services/NavigationService.cs`
**状态**: 整个服务类基本未被使用

**未使用内容**:
- `NavigationService` 类的所有成员:
  - `Instance` 单例
  - `TryRequestPath(Vector3 start, Vector3 end, out List<Vector3> path)` 方法

**说明**: 为 A* 寻路封装预留，但当前未被调用。

### 4. CommerceService.cs
**文件位置**: `Scripts/Customers/Services/CommerceService.cs`
**状态**: 整个商务服务类完全未被使用

**未使用内容**:
- `ReservationTicket` 结构体
- `CommerceService` 类的所有成员:
  - `Instance` 单例
  - `SoftReserve(ShelfInstance shelf, int wantQty)` 方法
  - `CommitAtCashier(ReservationTicket ticket)` 方法
  - `FindShelf(string id)` 私有方法

**说明**: 设计用于商品软预留和提交购买，但未被实际使用。

### 5. QueueService.cs
**文件位置**: `Scripts/Customers/Services/QueueService.cs`
**状态**: 整个队列服务类完全未被使用

**未使用内容**:
- `QueueService` 类的所有成员:
  - `GetLength(string pointId)` 方法
  - `Enter(string pointId)` 方法
  - `Leave(string pointId)` 方法
  - `PredictWaitSeconds(string pointId, int unitSeconds)` 方法
  - `_len` 私有字典

**说明**: 用于队列长度统计和等待时间预测，但未被调用。

### 6. HeatmapService.cs
**文件位置**: `Scripts/Customers/Services/HeatmapService.cs`
**状态**: 整个热图服务类基本未被使用

**未使用内容**:
- `HeatmapService` 类的所有成员:
  - `Instance` 单例
  - `GetEEBAt(Vector2Int cell)` 方法（仅返回固定值 0）

**说明**: 为尴尬值热图计算预留，目前只是占位实现。

### 7. CustomerSession.cs
**文件位置**: `Scripts/Customers/Runtime/CustomerSession.cs`
**状态**: 整个文件完全未被使用

**未使用内容**:
- `ShelfVisit` 类及其所有字段
- `CustomerSession` 类及其所有字段:
  - 会话标识、消费记录、行为统计等

**说明**: 设计用于记录顾客单次访问的详细数据，但未被创建或使用。

## 部分未使用的内容

### 8. CustomerPolicies.cs
**文件位置**: `Scripts/Customers/Data/CustomerPolicies.cs`
**状态**: 抽象类已定义，但缺少具体实现

**未使用内容**:
- 所有抽象策略类（已定义但无具体实现）:
  - `TargetSelectorPolicy`
  - `PurchasePolicy`
  - `QueuePolicy`
  - `PathPolicy`
  - `EmbarrassmentPolicy`
  - `CheckoutPolicy`
- 数据结构（已定义但未被使用）:
  - `CustomerContext` 结构体
  - `ShelfSnapshot` 结构体
  - `CashierSnapshot` 结构体

**说明**: 策略模式框架已搭建，但缺少具体策略实现类。

### 9. CustomerEventBus.cs
**文件位置**: `Scripts/Customers/Services/CustomerEventBus.cs`
**状态**: 部分事件未被使用

**未使用内容**:
- `OnBuildingChanged` 事件及其触发方法
- `OnShelfSoldOut` 事件及其触发方法
- `OnEEBChanged` 事件及其触发方法
- 对应的 `RaiseBuildingChanged`、`RaiseShelfSoldOut`、`RaiseEEBChanged` 方法

**已使用内容**:
- `OnSpawned` 事件和 `RaiseSpawned` 方法（在 CustomerAgent.cs 中被调用）

### 10. CustomerBlackboardAdaptor.cs
**文件位置**: `Scripts/Customers/Runtime/CustomerBlackboardAdaptor.cs`
**状态**: 部分字段未被实际使用

**未使用内容**:
- `goalCell` 字段
- `targetShelfId` 字段
- `targetCashierId` 字段
- `policies` 字段（虽然被赋值但未被读取使用）

**说明**: 这些字段设计用于行为树读写，但目前行为树尚未完全接入。

## 分析结论

### 代码类型分类

1. **框架预留代码**:
   - 策略系统（CustomerPolicies.cs）
   - 钩子系统（TraitHooks.cs）
   - 这些是为将来扩展预留的架构

2. **服务层未接入**:
   - NavigationService、CommerceService、QueueService、HeatmapService
   - 这些服务类已实现但未被实际调用

3. **数据记录未启用**:
   - CustomerSession - 会话记录系统
   - 部分事件总线功能

### 建议

1. **保留但标记**: 大部分未使用代码是为将来功能预留的，建议保留但添加注释标记其状态
2. **逐步接入**: 可以考虑逐步接入已实现的服务类，如先接入 QueueService
3. **实现策略**: 为 CustomerPolicies 创建具体的策略实现类
4. **清理无用**: 对于确定不会使用的部分（如某些黑板字段），可以考虑清理

### 总体评价

Scripts/Customers 文件夹展现了良好的架构设计思路，大部分未使用代码都是为扩展性考虑的前瞻性设计。这种做法有利于后续功能开发，但需要适当的文档说明以避免混淆。